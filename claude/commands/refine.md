# 既存ドキュメントのRefine（包括的な品質向上）を行う

あなたの主目的は、既存のMarkdownドキュメントを以下の観点から包括的に精査・改善することです：

- **コードベースとの整合性確認**: 実装との乖離を検出し、適切な修正方針を決定
- **文章品質の向上**: 可読性、構造化、一貫性の改善
- **情報の最新化と網羅性**: 不足情報の追加、古い情報の更新
- **ベストプラクティスへの準拠**: 業界標準やプロジェクト規約への適合

**重要**: 技術的正確性を保ちながら、ユーザビリティの高いドキュメントを実現する。

---

## 入力タスクの前提

- 対象は技術ドキュメント（README、API仕様、設計書など）のMarkdownファイル
- コードベースへの参照（関数名、クラス名、ファイルパス、設定値など）が含まれている
- ドキュメントが古くなっている、または不正確な記述がある可能性を想定

---

## 制約事項

- 推測や仮定に基づく修正は避け、実際のコードを確認した上で修正する
- 技術的な正確性と読みやすさのバランスを重視する
- 修正の影響範囲を慎重に評価し、破壊的変更を避ける
- プロジェクトのドキュメント規約やスタイルガイドに準拠する

---

## ドキュメント品質の評価基準

### 1. 構造と組織化

- **論理的な見出し階層**: セクションの粒度と順序が適切か
- **情報のグループ化**: 関連する内容が適切にまとまっているか
- **ナビゲーション**: 目次や内部リンクが効果的に配置されているか

### 2. 可読性とアクセシビリティ

- **明確な文章**: 簡潔で理解しやすい表現を使用しているか
- **専門用語の説明**: 初見の読者にも配慮した解説があるか
- **視覚的要素**: コードブロック、図表、リストが適切に活用されているか
- **例示の充実**: 具体的な使用例やユースケースが提供されているか

### 3. 完全性と正確性

- **必要情報の網羅**: 前提条件、インストール手順、設定方法が明記されているか
- **エッジケース**: 特殊なケースやエラー処理が記載されているか
- **制限事項**: 既知の問題や制約が明確に記述されているか

### 4. 保守性と持続可能性

- **更新日時**: 最終更新日やバージョン情報が記載されているか
- **変更履歴**: 重要な変更が追跡可能か
- **外部リンク**: リンク切れがなく、適切な参照先か
- **メンテナンス負荷**: 将来の更新が容易な構造になっているか

---

## 不整合発見時の判断基準

### ドキュメントとコードのどちらを修正すべきか

不整合を発見した場合、以下の基準に従って修正対象を決定する：

#### 1. ドキュメントを修正すべきケース

- **実装が正しく動作している場合**
  - 既存のテストが通っている
  - ユーザーからの動作報告がある
  - 依存システムが正常に連携している
- **意図的な仕様変更が行われた場合**
  - コミットログに変更理由が記載されている
  - チケットやIssueで議論された結果
- **ドキュメントの単純な誤記の場合**
  - タイポ、古い命名規則、パスの誤り

#### 2. コードを修正すべきケース

- **明らかなバグや実装ミスの場合**
  - ドキュメントに記載された仕様が合理的
  - テストが不足または誤っている
  - エラーハンドリングが不適切
- **セキュリティ上の問題がある場合**
  - ドキュメントに記載された方法が安全
  - 現在の実装に脆弱性がある
- **パフォーマンス問題がある場合**
  - ドキュメントの設計が効率的
  - 実装が非効率的なアルゴリズムを使用

#### 3. 両方を修正すべきケース

- **設計自体に問題がある場合**
  - より良い解決策が存在する
  - 技術的負債の解消が必要
- **部分的に正しい場合**
  - 基本的な動作は正しいが、エッジケースの扱いが不適切

#### 4. 判断保留とすべきケース

- **ビジネス要件が不明確な場合**
  - プロダクトオーナーとの確認が必要
  - ユーザーの期待値が不明
- **影響範囲が大きい場合**
  - 複数のシステムに影響する
  - 下位互換性の考慮が必要
- **歴史的経緯が不明な場合**
  - なぜその実装になったか不明
  - 過去の議論や決定事項が不明

---

## 確認・検証のステップ

### 1. 初期分析

- 対象ドキュメントの全体構造と目的を把握
- 読者ターゲットと期待される知識レベルの確認
- コードベースへの参照箇所をリストアップ
- 使用されている技術用語や概念の確認
- ドキュメントの更新履歴と変更頻度の把握

### 2. コードベースとの照合

以下の要素について実際のコードと照合する：

- **関数・メソッド名**: 存在確認、シグネチャの一致
- **クラス・モジュール構造**: 階層関係、インポートパス
- **設定値・定数**: 値の正確性、デフォルト値
- **ファイルパス**: 実際の配置場所、相対パスの起点
- **APIエンドポイント**: URL、HTTPメソッド、パラメータ
- **実行例・コマンド**: 動作確認、引数の妥当性

### 3. 品質評価とドキュメント分析

以下の観点から総合的に評価：

- **構造的問題**: 情報の組織化、流れ、階層構造の問題
- **内容の不足**: 欠けている重要情報、説明不足な箇所
- **表現の問題**: 曖昧な記述、冗長な説明、専門用語の乱用
- **フォーマット**: Markdown記法の誤用、スタイルの不統一

### 4. 不整合の分類

発見した不整合を以下のカテゴリに分類：

- **Critical**: 実行時エラーを引き起こす可能性のある誤り
- **Major**: 機能の誤解を招く可能性のある記述
- **Minor**: 細かい不正確さ（typo、古い命名規則など）
- **Outdated**: 廃止された機能への参照

---

## 修正・改善のガイドライン

### 修正の原則

1. **事実ベース**: コードから確認できる事実のみを記述
2. **具体性**: 抽象的な説明より具体的な例を優先
3. **バージョン意識**: 該当するバージョンや更新日を明記
4. **リンク整合性**: 内部リンク、外部リンクの有効性を確認

### 追加すべき情報

- 前提条件や依存関係の明確化
- エラーケースやエッジケースの記述
- 実際の使用例（可能な限りテスト済みのもの）

---

## 出力フォーマット

### 1. 検証レポート

```markdown
# ドキュメント検証レポート: ${ファイル名}

## 検証日時
${YYYY-MM-DD HH:MM}

## 検証サマリ
- 総参照数: X件
- 不整合発見数: Y件（Critical: A, Major: B, Minor: C, Outdated: D）
- ドキュメント品質スコア: X/100
  - 構造と組織化: X/25
  - 可読性とアクセシビリティ: X/25
  - 完全性と正確性: X/25
  - 保守性と持続可能性: X/25

## 詳細な検証結果

### Critical Issues
1. [${項目名}]
   - 文書の記述: `${記述内容}`
   - 実際のコード: `${コード内容}`
   - 影響: ${影響の説明}
   - 推奨対応: ${ドキュメント修正/コード修正/両方/保留}
   - 理由: ${判断理由}
   - 修正案: ${修正提案}

### Major Issues
...

## ドキュメント品質の詳細評価

### 構造と組織化
- [問題点]
- [改善提案]

### 可読性とアクセシビリティ
- [問題点]
- [改善提案]

### 完全性と正確性
- [問題点]
- [改善提案]

### 保守性と持続可能性
- [問題点]
- [改善提案]

## 推奨アクション
1. 即座に修正すべき項目
2. 次回更新時に対応すべき項目
3. 要確認事項（他チームとの調整が必要など）
```

### 2. 修正後のドキュメント

- 変更箇所にはコメントで理由を付記
- 更新履歴セクションに変更内容を記録
- 可能であればdiffフォーマットで変更点を提示

---

## 完了の定義

以下の条件を満たした時点で検証・改善作業を完了とする：

- すべてのコード参照が現在のコードベースと一致している
- Criticalレベルの不整合がゼロ
- ドキュメント品質スコアが目標基準（80/100）以上
- 更新履歴に変更内容が記録されている
- 修正方針（ドキュメント/コード/両方）が明確になっている
- （オプション）自動検証スクリプトが正常に通過する
